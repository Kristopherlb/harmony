Generator Specification: generate_blueprint_code1. ContextType: Deterministic Assembly Engine (Nx/Projen Generator).Input: JSON Blueprint Architecture (from architect_workflow_logic) + WCS-001 Standard.Goal: Scaffolding production-ready, compilable BaseBlueprint classes and TDD suites without LLM intervention.Dependencies: Adheres to Standards/WCS-001-workflow-composition.md.2. Assembly Logic<system_role>
This is a specification for the Automated Assembly Engine.
The engine consumes a validated JSON Architecture Plan and generates TypeScript source code. It treats the JSON as a strict AST (Abstract Syntax Tree).</system_role><engineering_guidelines>Late-Binding Secrets: The engine MUST only map logical secret names (e.g., jiraToken) to the OCS SecretSchema. It MUST NOT require or validate the presence of actual secret values during assembly.Zero-Hallucination Implementation: The engine uses pre-defined TypeScript templates. It does not "write" logic; it maps JSON DAG steps to this.execute(Capability, input) calls.TDD Automation: Every generated blueprint MUST include a corresponding blueprint.test.ts that mocks all Capability activities defined in the DAG.Strict Determinism: The engine MUST wrap all logic in the BaseBlueprint abstractions. Direct use of non-deterministic JS globals is a generation-time failure.</engineering_guidelines><assembly_tasks>Structural Scaffolding:Create a new Nx library/package: packages/blueprints/${namespace}/${use_case}.Generate index.ts exporting the Blueprint class.Metadata & Security Mapping:Inject blueprint_metadata into the class metadata property.Map security_logic.required_roles to the class security configuration.Schema Synthesis:For each step in the DAG, the engine MUST look up the InputSchema of the referenced Capability in the Schema Registry.It MUST synthesize a unified inputSchema for the Blueprint that represents the aggregate of all required initial inputs.Logic Flow Assembly:The logic() method is generated by iterating through the DAG steps.Data Wiring: For each step, use the input_mapping defined in the JSON to wire context variables or outputs from previous steps.Parallelism: Steps with is_parallel: true must be wrapped in Promise.all().APS Batching: If aps_strategy is batched, the engine injects a standard chunking loop utility.Saga Injection:For every step with a defined compensation, the engine MUST inject the this.addCompensation block immediately following the execution call.Test Suite Generation:The generator produces tests for every acceptance_tests scenario provided in the JSON plan.It uses TestWorkflowEnvironment from @temporalio/testing.</assembly_tasks><output_artifacts>blueprint.ts: The deterministic class implementation.blueprint.test.ts: The auto-generated Vitest suite.blueprint.config.json: Default configuration for the Binder.
</output_artifacts>
