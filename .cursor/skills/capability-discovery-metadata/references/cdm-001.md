<!-- path: .cursor/skills/capability-discovery-metadata/references/cdm-001.md -->

# Capability Discovery Metadata Standard (CDM-001)

| Metadata | Value |
| --- | --- |
| ID | CDM-001 |
| Version | 1.0.0 |
| Status | DRAFT |
| Authors | Platform Engineering |
| Context | Deterministic tool discovery across Console + MCP |

## 1. Scope

Standardize discovery taxonomy and related metadata required to build a deterministic tool catalog and to render stable UI groupings.

- **In scope**:
  - OCS Capability `metadata` fields used for discovery and grouping
  - Blueprint Descriptor `metadata` fields used for discovery and grouping
  - Validation rules for taxonomy correctness and determinism
- **Out of scope**:
  - Pattern classification (Connector/Commander/etc.) beyond the existing capability `type`
  - UI styling and layout decisions beyond deterministic ordering keys
  - Authorization policy evaluation (RBAC), beyond declaring metadata used for filtering

## 2. Terms (canonical glossary)

- **Canonical ID**: The `metadata.id` string used as the stable identity surface (see NIS-001).
- **Domain**: A coarse discovery grouping represented by `metadata.domain` (e.g., `security`, `observability`, `ci`, `k8s`).
- **Subdomain**: An optional finer grouping represented by `metadata.subdomain` (e.g., `sbom`, `oauth`, `grafana`).
- **Tags**: A non-empty set of keywords (`metadata.tags`) used for search and secondary grouping.
- **Discovery metadata**: The minimal metadata required to deterministically index and group tools across Console + MCP.

## 3. Normative language

This standard uses RFC-style normative keywords: MUST, SHOULD, MAY.

## 4. Normative requirements

### 4.1 Required discovery fields

- **REQ-CDM-001**: Every Capability and Blueprint exposed via registries/MCP MUST define `metadata.domain` as a non-empty lowercase kebab-case string.
- **REQ-CDM-002**: Every Capability and Blueprint exposed via registries/MCP MAY define `metadata.subdomain` as a non-empty lowercase kebab-case string.
- **REQ-CDM-003**: Every Capability and Blueprint exposed via registries/MCP MUST define `metadata.tags` as a non-empty array of non-empty strings.
- **REQ-CDM-004**: `metadata.tags` MUST include `metadata.domain`.

### 4.2 Canonical ID alignment

- **REQ-CDM-005**: `metadata.id` MUST be a lowercase dotted identifier.
- **REQ-CDM-006**: `metadata.id` MUST begin with `golden.`.
- **REQ-CDM-007**: The domain segment of `metadata.id` (the token after `golden.`) MUST equal `metadata.domain`.
- **REQ-CDM-008**: If `metadata.subdomain` is defined, it SHOULD appear as the next segment(s) of `metadata.id` after the domain (e.g., `golden.<domain>.<subdomain>`). During migration this is a SHOULD, not a MUST.

### 4.3 Deterministic ordering keys

- **REQ-CDM-009**: Any generated catalog MUST provide stable ordering by:
  - primary: `metadata.domain` (ascending)
  - secondary: `metadata.subdomain` (ascending, undefined last)
  - tertiary: `metadata.id` (ascending)

### 4.4 Recommended friendly labels (non-normative mapping)

The following mapping SHOULD be used by the Console to display friendly names for domains:

- `ci` → “CI/CD”
- `k8s` → “Kubernetes”
- `sbom` → “SBOM”
- `observability` → “Observability”

## 5. Validation rules (machine-checkable)

- **VAL-CDM-001**:
  - **Input(s)**: Capability exports + Blueprint descriptors (registries).
  - **Rule**: `metadata.domain` exists and matches `^[a-z0-9]+(?:-[a-z0-9]+)*$`.
  - **Fail message**: `CDM-001: metadata.domain is required and must be kebab-case`
  - **Severity**: FAIL
  - **Autofix**: NO

- **VAL-CDM-002**:
  - **Input(s)**: Capability exports + Blueprint descriptors (registries).
  - **Rule**: `metadata.subdomain` is undefined OR matches `^[a-z0-9]+(?:-[a-z0-9]+)*$`.
  - **Fail message**: `CDM-001: metadata.subdomain must be kebab-case when provided`
  - **Severity**: FAIL
  - **Autofix**: NO

- **VAL-CDM-003**:
  - **Input(s)**: Capability exports + Blueprint descriptors (registries).
  - **Rule**: `metadata.tags` exists AND is an array AND `metadata.tags.length >= 1` AND every entry is a non-empty string.
  - **Fail message**: `CDM-001: metadata.tags is required and must be a non-empty string[]`
  - **Severity**: FAIL
  - **Autofix**: YES (generator can add domain tag deterministically)

- **VAL-CDM-004**:
  - **Input(s)**: Capability exports + Blueprint descriptors (registries).
  - **Rule**: `metadata.tags` includes `metadata.domain`.
  - **Fail message**: `CDM-001: metadata.tags must include metadata.domain`
  - **Severity**: FAIL
  - **Autofix**: YES

- **VAL-CDM-005**:
  - **Input(s)**: Capability exports + Blueprint descriptors (registries).
  - **Rule**: `metadata.id` starts with `golden.` AND the segment after `golden.` equals `metadata.domain`.
  - **Fail message**: `CDM-001: metadata.domain must match the domain segment of metadata.id`
  - **Severity**: FAIL
  - **Autofix**: NO

## 6. Test vectors (required)

### 6.1 Valid capability taxonomy

- **Given**:

```json
{
  "metadata": {
    "id": "golden.observability.grafana.query-dashboards",
    "domain": "observability",
    "subdomain": "grafana",
    "tags": ["observability", "grafana", "dashboards"]
  }
}
```

- **When**: CDM validation runs
- **Then**: PASS

### 6.2 Missing domain

- **Given**:

```json
{
  "metadata": {
    "id": "golden.security.oauth.exchange-token",
    "tags": ["security", "oauth"]
  }
}
```

- **When**: CDM validation runs
- **Then**: FAIL with `CDM-001: metadata.domain is required and must be kebab-case`

### 6.3 Domain mismatch

- **Given**:

```json
{
  "metadata": {
    "id": "golden.ci.github.create-issue",
    "domain": "security",
    "tags": ["security", "github"]
  }
}
```

- **When**: CDM validation runs
- **Then**: FAIL with `CDM-001: metadata.domain must match the domain segment of metadata.id`

## 7. Examples (non-normative)

### 7.1 Blueprint descriptor taxonomy

```json
{
  "metadata": {
    "id": "golden.ci.release-pipeline",
    "domain": "ci",
    "tags": ["ci", "release", "pipeline"]
  }
}
```

## 8. Changelog

- **1.0.0**: Initial draft (domains/subdomains/tags + deterministic ordering + validation rules).

